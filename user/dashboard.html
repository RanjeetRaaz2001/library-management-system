<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Library Management</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-container">
    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-book"></i> LMS User</h2>
            <p class="role-badge status-active">Library User</p>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-section">
                <h3>Main Navigation</h3>
                <ul class="nav-links">
                    <li><a href="dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                </ul>
            </div>
            
            <div class="nav-section">
                <h3>Reports</h3>
                <ul class="nav-links">
                    <li><a href="reports.html?type=books"><i class="fas fa-book"></i> Book List</a></li>
                    <li><a href="reports.html?type=movies"><i class="fas fa-film"></i> Movie List</a></li>
                    <li><a href="reports.html?type=myissues"><i class="fas fa-exchange-alt"></i> My Issues</a></li>
                    <li><a href="reports.html?type=myfines"><i class="fas fa-money-bill-wave"></i> My Fines</a></li>
                </ul>
            </div>
            
            <div class="nav-section">
                <h3>Transactions</h3>
                <ul class="nav-links">
                    <li><a href="transactions.html?action=search"><i class="fas fa-search"></i> Book Search</a></li>
                    <li><a href="transactions.html?action=issue"><i class="fas fa-share-square"></i> Issue Book</a></li>
                    <li><a href="transactions.html?action=return"><i class="fas fa-undo"></i> Return Book</a></li>
                    <li><a href="transactions.html?action=fine"><i class="fas fa-money-bill-wave"></i> Pay Fine</a></li>
                </ul>
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <a href="../index.html" class="btn btn-secondary" style="margin: 10px; display: block; text-align: center;">
                <i class="fas fa-home"></i> Home
            </a>
            <a href="#" class="logout-btn btn btn-user" style="margin: 10px 20px; display: block; text-align: center;">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </aside>
    
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <h1>User Dashboard</h1>
            <p>Welcome back, <strong id="userName">Library User</strong></p>
        </div>
        
        <div class="header-right">
            <div class="user-profile" id="userProfile">
                <!-- Filled by JavaScript -->
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="dashboard-main">
        <!-- User Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon books">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-info">
                    <h3 id="userBooksIssued">0</h3>
                    <p>Books Issued</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon members">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-info">
                    <h3 id="daysRemaining">0</h3>
                    <p>Days Remaining</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon issues">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="booksRead">0</h3>
                    <p>Books Read</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon fines">
                    <i class="fas fa-rupee-sign"></i>
                </div>
                <div class="stat-info">
                    <h3 id="totalFines">₹0</h3>
                    <p>Fines Paid</p>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <section class="quick-actions">
            <h2>Quick Actions</h2>
            <div class="actions-grid">
                <a href="transactions.html?action=search" class="action-btn">
                    <i class="fas fa-search"></i>
                    Search Books
                </a>
                <a href="transactions.html?action=issue" class="action-btn">
                    <i class="fas fa-share-square"></i>
                    Issue Book
                </a>
                <a href="transactions.html?action=return" class="action-btn">
                    <i class="fas fa-undo"></i>
                    Return Book
                </a>
                <a href="reports.html?type=books" class="action-btn">
                    <i class="fas fa-book"></i>
                    View Catalog
                </a>
                <a href="reports.html?type=myissues" class="action-btn">
                    <i class="fas fa-list"></i>
                    My Issues
                </a>
                <a href="transactions.html?action=fine" class="action-btn">
                    <i class="fas fa-money-bill-wave"></i>
                    Pay Fine
                </a>
            </div>
        </section>
        
        <!-- Currently Issued Books -->
        <section class="chart-container">
            <div class="chart-header">
                <h3>Currently Issued Books</h3>
                <a href="reports.html?type=myissues" class="btn btn-secondary btn-sm">View All</a>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Book Name</th>
                            <th>Author</th>
                            <th>Issue Date</th>
                            <th>Due Date</th>
                            <th>Days Left</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="issuedBooks">
                        <!-- Filled by JavaScript -->
                    </tbody>
                </table>
                <div class="empty-state" id="noIssuedBooks" style="display: none;">
                    <i class="fas fa-book-open fa-2x"></i>
                    <h4>No Books Issued</h4>
                    <p>You haven't issued any books yet</p>
                    <a href="transactions.html?action=search" class="btn btn-primary">Browse Books</a>
                </div>
            </div>
        </section>
        
        <!-- Recently Added Books by Admin -->
        <section class="recent-activity">
            <div class="activity-header">
                <h2><i class="fas fa-star"></i> Newly Added Books</h2>
                <button class="btn btn-secondary btn-sm" onclick="refreshBooks()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div class="books-grid" id="recentBooks">
                <!-- Filled by JavaScript -->
            </div>
            <div class="empty-state" id="noBooksMessage" style="display: none;">
                <i class="fas fa-book fa-3x"></i>
                <h4>No Books Available</h4>
                <p>Library catalog is empty</p>
                <p class="text-muted">Admin will add books soon</p>
            </div>
        </section>
        
        <!-- Available Books by Category -->
        <section class="chart-container">
            <div class="chart-header">
                <h3><i class="fas fa-tags"></i> Books by Category</h3>
            </div>
            <div class="category-grid" id="categoryBooks">
                <!-- Dynamic categories -->
            </div>
        </section>
        
        <!-- User Information -->
        <div class="user-info-card">
            <h3><i class="fas fa-user-circle"></i> My Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <label>Membership ID:</label>
                    <span id="memberId">MEM000123</span>
                </div>
                <div class="info-item">
                    <label>Membership Type:</label>
                    <span id="memberType">Premium (1 Year)</span>
                </div>
                <div class="info-item">
                    <label>Valid Until:</label>
                    <span id="memberValid">2024-12-31</span>
                </div>
                <div class="info-item">
                    <label>Total Books Issued:</label>
                    <span id="totalIssued">0</span>
                </div>
                <div class="info-item">
                    <label>Available Books:</label>
                    <span id="availableBooks">0</span>
                </div>
                <div class="info-item">
                    <label>Reading Level:</label>
                    <span id="readingLevel">Beginner</span>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Yeh scripts sabhi pages mein include hone chahiye -->
    <script src="../js/auth.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/validations.js"></script>
    <!-- dashboard.html में सिर्फ <script> tag के अंदर का code replace करें -->

<script>
    console.log("User Dashboard loaded");
    
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize storage
        LibraryStorage.init();
        
        // Initialize user data
        initUserData();
        
        // Set user info
        const userName = sessionStorage.getItem('userName') || 'Library User';
        document.getElementById('userName').textContent = userName;
        
        // Populate user profile
        document.getElementById('userProfile').innerHTML = `
            <i class="fas fa-user-circle fa-2x"></i>
            <div>
                <strong>${userName}</strong><br>
                <small>Library User</small>
            </div>
        `;
        
        // Load dashboard data
        loadUserDashboard();
        
        // Auto-refresh every 60 seconds
        setInterval(loadUserDashboard, 60000);
    });
    
    // Initialize user data
    function initUserData() {
        const userId = sessionStorage.getItem('userId') || 'user';
        
        // Initialize user stats
        if (!localStorage.getItem(`userStats_${userId}`)) {
            const userStats = {
                booksRead: 0,
                totalFines: 0,
                membershipId: 'MEM000123',
                membershipType: 'Premium (1 Year)',
                validUntil: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                readingLevel: 'Beginner'
            };
            localStorage.setItem(`userStats_${userId}`, JSON.stringify(userStats));
        }
    }
    
    // Load user dashboard data
    function loadUserDashboard() {
        console.log("Loading user dashboard data...");
        
        // Get data from storage
        const books = LibraryStorage.getBooks();
        const memberId = "MEM000123";
        const userIssues = LibraryStorage.getUserIssues(memberId);
        const userStats = getUserStats();
        
        console.log("Data loaded:", {
            totalBooks: books.length,
            availableBooks: books.filter(b => b.status === 'Available').length,
            userIssues: userIssues.length
        });
        
        // Update stats
        updateUserStats(userIssues, userStats, books);
        
        // Update issued books
        updateIssuedBooks(userIssues);
        
        // Update recently added books (by admin)
        updateRecentBooks(books);
        
        // Update books by category
        updateCategoryBooks(books);
        
        // Update user information
        updateUserInfo(userStats, books, userIssues.length);
    }
    
    // Update user statistics
    function updateUserStats(userIssues, userStats, books) {
        // Calculate days remaining for earliest due book
        let daysRemaining = 0;
        if (userIssues.length > 0) {
            const earliestDue = userIssues.reduce((min, issue) => {
                const dueDate = new Date(issue.dueDate);
                return dueDate < min ? dueDate : min;
            }, new Date(userIssues[0].dueDate));
            
            const today = new Date();
            daysRemaining = Math.ceil((earliestDue - today) / (1000 * 60 * 60 * 24));
            daysRemaining = Math.max(0, daysRemaining);
        }
        
        // Calculate fines
        let totalFines = 0;
        const today = new Date().toISOString().split('T')[0];
        
        userIssues.forEach(issue => {
            if (issue.dueDate < today) {
                const daysOverdue = Math.ceil(
                    (new Date(today) - new Date(issue.dueDate)) / 
                    (1000 * 60 * 60 * 24)
                );
                totalFines += daysOverdue * 10;
            }
        });
        
        // Update DOM
        document.getElementById('userBooksIssued').textContent = userIssues.length;
        document.getElementById('daysRemaining').textContent = daysRemaining;
        document.getElementById('booksRead').textContent = userStats.booksRead || 0;
        document.getElementById('totalFines').textContent = `₹${totalFines}`;
        
        // Update available books count
        const availableBooks = books.filter(b => b.status === 'Available').length;
        document.getElementById('availableBooks').textContent = availableBooks;
    }
    
    // Update issued books table
    function updateIssuedBooks(userIssues) {
        const issuedBooksContainer = document.getElementById('issuedBooks');
        const noIssuedBooks = document.getElementById('noIssuedBooks');
        
        if (userIssues.length === 0) {
            if (issuedBooksContainer) issuedBooksContainer.style.display = 'none';
            if (noIssuedBooks) noIssuedBooks.style.display = 'block';
            return;
        }
        
        if (noIssuedBooks) noIssuedBooks.style.display = 'none';
        if (issuedBooksContainer) {
            issuedBooksContainer.style.display = 'table-row-group';
            
            let html = '';
            userIssues.forEach(issue => {
                const dueDate = new Date(issue.dueDate);
                const today = new Date();
                const daysLeft = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                
                const statusClass = daysLeft <= 2 ? 'badge badge-danger' : 
                                  daysLeft <= 5 ? 'badge badge-warning' : 'badge badge-success';
                
                html += `
                    <tr>
                        <td>${issue.bookName || 'Unknown Book'}</td>
                        <td>${issue.bookAuthor || 'Unknown Author'}</td>
                        <td>${issue.issueDate || 'N/A'}</td>
                        <td>${issue.dueDate || 'N/A'}</td>
                        <td><span class="${statusClass}">${daysLeft} days</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="renewBook(${issue.id}, '${issue.bookName}')">
                                <i class="fas fa-sync-alt"></i> Renew
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="returnBook(${issue.id}, '${issue.bookName}')">
                                <i class="fas fa-undo"></i> Return
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            issuedBooksContainer.innerHTML = html;
        }
    }
    
    // Update recently added books (by admin)
    function updateRecentBooks(books) {
        const recentBooksContainer = document.getElementById('recentBooks');
        const noBooksMessage = document.getElementById('noBooksMessage');
        
        // Filter available books
        const availableBooks = books.filter(book => book.status === 'Available');
        
        if (availableBooks.length === 0) {
            if (recentBooksContainer) recentBooksContainer.style.display = 'none';
            if (noBooksMessage) noBooksMessage.style.display = 'block';
            return;
        }
        
        if (noBooksMessage) noBooksMessage.style.display = 'none';
        if (recentBooksContainer) {
            recentBooksContainer.style.display = 'grid';
            
            // Sort by added date (newest first)
            const sortedBooks = [...availableBooks].sort((a, b) => {
                return new Date(b.addedDate || b.procurementDate || 0) - 
                       new Date(a.addedDate || a.procurementDate || 0);
            });
            
            // Take only last 6 books
            const recentBooks = sortedBooks.slice(0, 6);
            
            let html = '';
            recentBooks.forEach(book => {
                const addedDate = book.addedDate || book.procurementDate;
                const isNew = isNewBook(addedDate);
                
                html += `
                    <div class="book-card">
                        <div class="book-header">
                            <div class="book-icon">
                                <i class="fas fa-book"></i>
                                ${isNew ? '<span class="new-badge">NEW</span>' : ''}
                            </div>
                            <span class="book-category">${book.category || 'General'}</span>
                        </div>
                        <div class="book-info">
                            <h4>${book.name}</h4>
                            <p class="book-author">${book.author}</p>
                            <div class="book-details">
                                <span class="book-serial">${book.serial}</span>
                                <span class="book-status status-active">Available</span>
                            </div>
                        </div>
                        <div class="book-actions">
                            <button class="btn btn-sm btn-primary" onclick="viewBookDetails('${book.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn btn-sm btn-success" onclick="issueBookFromDashboard('${book.id}', '${book.name}', '${book.serial}')">
                                <i class="fas fa-share-square"></i> Issue
                            </button>
                        </div>
                    </div>
                `;
            });
            
            recentBooksContainer.innerHTML = html;
        }
    }
    
    // Update books by category
    function updateCategoryBooks(books) {
        const categoryContainer = document.getElementById('categoryBooks');
        
        if (!categoryContainer) return;
        
        // Group books by category
        const booksByCategory = {};
        books.forEach(book => {
            const category = book.category || 'Uncategorized';
            if (!booksByCategory[category]) {
                booksByCategory[category] = [];
            }
            booksByCategory[category].push(book);
        });
        
        // Sort categories by book count
        const sortedCategories = Object.entries(booksByCategory)
            .sort((a, b) => b[1].length - a[1].length)
            .slice(0, 4); // Top 4 categories
        
        let html = '';
        sortedCategories.forEach(([category, categoryBooks]) => {
            const availableCount = categoryBooks.filter(b => b.status === 'Available').length;
            
            html += `
                <div class="category-card">
                    <div class="category-header">
                        <h4>${category}</h4>
                        <span class="book-count">${categoryBooks.length} books</span>
                    </div>
                    <div class="category-info">
                        <p><i class="fas fa-check-circle"></i> ${availableCount} available</p>
                        <p><i class="fas fa-clock"></i> ${categoryBooks.length - availableCount} issued</p>
                    </div>
                    <div class="category-books">
                        ${categoryBooks.slice(0, 2).map(book => `
                            <div class="mini-book">
                                <i class="fas fa-book"></i>
                                <span>${book.name.substring(0, 20)}${book.name.length > 20 ? '...' : ''}</span>
                            </div>
                        `).join('')}
                        ${categoryBooks.length > 2 ? `<div class="more-books">+${categoryBooks.length - 2} more</div>` : ''}
                    </div>
                    <a href="reports.html?type=books&category=${encodeURIComponent(category)}" class="btn btn-sm btn-outline">
                        View All
                    </a>
                </div>
            `;
        });
        
        categoryContainer.innerHTML = html;
    }
    
    // Update user information
    function updateUserInfo(userStats, books, totalIssued) {
        if (document.getElementById('memberId')) {
            document.getElementById('memberId').textContent = userStats.membershipId || 'MEM000123';
            document.getElementById('memberType').textContent = userStats.membershipType || 'Premium (1 Year)';
            document.getElementById('memberValid').textContent = userStats.validUntil || '2024-12-31';
            document.getElementById('totalIssued').textContent = totalIssued;
            document.getElementById('readingLevel').textContent = userStats.readingLevel || 'Beginner';
            
            // Calculate reading level based on books read
            const booksRead = userStats.booksRead || 0;
            if (booksRead >= 20) {
                document.getElementById('readingLevel').textContent = 'Expert';
            } else if (booksRead >= 10) {
                document.getElementById('readingLevel').textContent = 'Intermediate';
            }
        }
    }
    
    // Get user stats
    function getUserStats() {
        const userId = sessionStorage.getItem('userId') || 'user';
        return JSON.parse(localStorage.getItem(`userStats_${userId}`) || '{}');
    }
    
    // Save user stats
    function saveUserStats(stats) {
        const userId = sessionStorage.getItem('userId') || 'user';
        localStorage.setItem(`userStats_${userId}`, JSON.stringify(stats));
    }
    
    // Helper functions
    function isNewBook(dateString) {
        if (!dateString) return false;
        const bookDate = new Date(dateString);
        const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
        return bookDate > weekAgo;
    }
    
    // Action functions
    function viewBookDetails(bookId) {
        const books = LibraryStorage.getBooks();
        const book = books.find(b => b.id == bookId);
        
        if (book) {
            const details = `
                <strong>${book.name}</strong><br>
                <strong>Author:</strong> ${book.author}<br>
                <strong>Category:</strong> ${book.category}<br>
                <strong>Serial:</strong> ${book.serial}<br>
                <strong>Status:</strong> ${book.status}<br>
                <strong>Available Copies:</strong> ${book.quantity || 1}<br>
                <strong>Added:</strong> ${book.addedDate || book.procurementDate || 'N/A'}<br>
                ${book.description ? `<strong>Description:</strong><br>${book.description}` : ''}
            `;
            
            alert(details);
        }
    }
    
    // **FIXED: Issue book from dashboard - CORRECT VERSION**
    function issueBookFromDashboard(bookId, bookName, bookSerial) {
        console.log("Issue function called:", { bookId, bookName, bookSerial });
        
        if (confirm(`Do you want to issue "${bookName}"?`)) {
            const books = LibraryStorage.getBooks();
            const book = books.find(b => b.id == bookId);
            
            if (book && book.status === 'Available' && book.quantity > 0) {
                // Get user information
                const userName = sessionStorage.getItem('userName') || 'Library User';
                const memberId = "MEM000123";
                
                // Calculate due date (15 days from now)
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + 15);
                const dueDateStr = dueDate.toISOString().split('T')[0];
                
                console.log("Using serial number for issue:", bookSerial);
                
                // **FIXED: Use LibraryStorage.issueBook with serial number**
                const issued = LibraryStorage.issueBook(bookSerial, memberId, userName, dueDateStr);
                
                if (issued) {
                    alert(`✅ Book "${bookName}" issued successfully!\n\nDue Date: ${dueDateStr}\nTransaction ID: TXN${Date.now().toString().slice(-6)}`);
                    
                    // Update user stats
                    const userStats = getUserStats();
                    userStats.booksRead = (userStats.booksRead || 0) + 1;
                    saveUserStats(userStats);
                    
                    // Refresh dashboard
                    loadUserDashboard();
                } else {
                    alert('Failed to issue book. Please try again.');
                }
            } else {
                alert('Sorry, this book is not available for issue.');
            }
        }
    }
    
    function renewBook(issueId, bookName) {
        if (confirm(`Do you want to renew "${bookName}" for 15 more days?`)) {
            // In real app, this would update the due date
            alert(`Book "${bookName}" renewed successfully!`);
            loadUserDashboard();
        }
    }
    
    function returnBook(issueId, bookName) {
        if (confirm(`Do you want to return "${bookName}"?`)) {
            const today = new Date().toISOString().split('T')[0];
            
            // Return the book using LibraryStorage
            const returned = LibraryStorage.returnBook(issueId, today);
            if (returned) {
                alert(`Book "${bookName}" returned successfully!`);
                
                // Update user stats
                const userStats = getUserStats();
                userStats.booksRead = (userStats.booksRead || 0) + 1;
                saveUserStats(userStats);
                
                // Refresh dashboard
                loadUserDashboard();
            } else {
                alert('Failed to return book. Please try again.');
            }
        }
    }
    
    function refreshBooks() {
        console.log("Refreshing books...");
        loadUserDashboard();
        
        // Show notification
        showNotification('Books list refreshed!', 'success');
    }
    
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        notification.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: ${type === 'success' ? '#4caf50' : '#2196f3'};
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideUp 0.3s ease;
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideDown 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
    // Add animation styles
    const animationStyles = document.createElement('style');
    animationStyles.textContent = `
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideDown {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(100%); opacity: 0; }
        }
        .text-muted {
            color: #6c757d;
            font-size: 12px;
        }
    `;
    document.head.appendChild(animationStyles);
</script>
    
    <style>
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .book-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 15px;
            transition: transform 0.3s ease;
            border: 1px solid #eee;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .book-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .book-icon {
            position: relative;
            width: 50px;
            height: 50px;
            background: var(--light-gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--secondary-color);
        }
        
        .new-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff5722;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .book-category {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .book-info h4 {
            margin-bottom: 8px;
            color: var(--primary-color);
            font-size: 16px;
            line-height: 1.4;
        }
        
        .book-author {
            color: var(--dark-gray);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .book-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        
        .book-serial {
            color: #666;
            font-family: monospace;
        }
        
        .book-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        
        .book-actions .btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .category-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-top: 4px solid var(--user-color);
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .category-header h4 {
            color: var(--primary-color);
            margin: 0;
        }
        
        .book-count {
            background: var(--light-gray);
            color: var(--dark-gray);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .category-info {
            margin-bottom: 15px;
        }
        
        .category-info p {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
            font-size: 14px;
            color: var(--dark-gray);
        }
        
        .category-info i {
            color: var(--user-color);
        }
        
        .category-books {
            margin-bottom: 15px;
        }
        
        .mini-book {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .mini-book i {
            color: var(--secondary-color);
        }
        
        .more-books {
            text-align: center;
            color: var(--dark-gray);
            font-size: 12px;
            padding: 5px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--user-color);
            color: var(--user-color);
            width: 100%;
        }
        
        .btn-outline:hover {
            background: var(--user-color);
            color: white;
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--dark-gray);
        }
        
        .empty-state i {
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .empty-state h4 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .empty-state p {
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .books-grid {
                grid-template-columns: 1fr;
            }
            
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .activity-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .book-actions {
                flex-direction: column;
            }
        }
    </style>
</body>
</html>
